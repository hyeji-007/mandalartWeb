import{a as F,f as W,j as e,r as f}from"./index-DRgm4NuZ.js";import{P as w}from"./PopupLayout-DEN_2vDs.js";const P=async c=>{try{return(await F.get(`/api/mand?projectId=${c}`)).data.resultData}catch(p){console.log(" 데이터 불러오기 실패",p)}},T="_MandalartWrap_1b06y_1",B={MandalartWrap:T},L="_MandalartSingleTable_5ueoo_1",R="_desable_5ueoo_49",$={MandalartSingleTable:L,desable:R};function O({jsonData:c,openModal:p}){const m=W(),g="/myplan/edit";let h=Array.from(Array(3).fill({}),()=>new Array(3).fill({}));const t=s=>{p(s)},x=()=>h.map((s,d)=>e.jsx("tr",{children:s.map((r,M)=>e.jsx("td",{style:{backgroundColor:r.bgColor},children:e.jsx("button",{style:{cursor:m.pathname===g?"pointer":"default"},onClick:()=>t(r),children:r.title})},`cell-${d}-${M}`))},`row-${d}`));if(c.mandalartId!=null){h[1][1]=c;let s=0,d=0;for(const r of c.child)s==1&&d==1&&s++,h[d][s]=r,s++,s==3&&(s=0,d++)}return e.jsx("table",{className:$.MandalartSingleTable,children:e.jsx("tbody",{children:x()})})}function G({projectId:c}){var N,S;const p=W(),m="/myplan/edit",[g,h]=f.useState(!1),[t,x]=f.useState(null),[s,d]=f.useState([]),[r,M]=f.useState(),I=()=>{h(!1)},_=a=>{x(a),h(!0)},j=a=>{const{name:l,value:o}=a.target;x(i=>({...i,[l]:o}))},v=a=>{x(l=>({...l,completedFg:a}))},k=async a=>{a.preventDefault();try{const l=await F.patch("/api/mand/update",t);console.log("서버 응답:",l.data);const o=l.data;o.statusCode!=="200"?alert(o.resultMsg):(I(),A())}catch(l){alert("요청 실패:",l)}},A=async()=>{let l=(await P(c)).mandalart,o=l.find(n=>n.depth==0),i=l.filter(n=>n.depth==1),y=l.filter(n=>n.depth==2);M(()=>[o,...i,...y]),i=i.sort((n,u)=>n.orderId-u.orderId),y=y.sort((n,u)=>n.orderId-u.orderId),o.child=new Array;for(const n of i)o.mandalartId==n.parentId&&o.child.push(n);for(let n=0;n<i.length;n++){i[n].child=new Array;for(const u of y)i[n].mandalartId==u.parentId&&i[n].child.push(u)}const C=new Array(9).fill({});C[4]=o;let b=0;for(const n of i)b==4&&b++,C[b]=n,b++;d(C)};return f.useEffect(()=>{A()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:B.MandalartWrap,children:s.map((a,l)=>e.jsx("div",{children:e.jsx(O,{jsonData:a,openModal:_})},l))}),g&&p.pathname===m&&e.jsxs(w,{isVisible:g,onClose:I,children:[e.jsx("input",{type:"hidden",value:t.parentId}),e.jsxs("div",{className:"inputBox",children:[e.jsx("label",{htmlFor:"title",children:"실천목표 입력"}),e.jsx("input",{type:"text",id:"title",name:"title",maxLength:50,className:"popupInput",placeholder:"실천 목표를 입력하세요.",value:t==null?void 0:t.title,onChange:j})]}),e.jsxs("div",{className:"inputBox",children:[e.jsxs("label",{htmlFor:"startDate",children:["시작일",(t==null?void 0:t.depth)==1&&e.jsxs("span",{style:{color:"#999",fontWeight:"400"},children:[" (",s[4].startDate,"부터)"]}),(t==null?void 0:t.depth)==2&&e.jsxs("span",{style:{color:"#999",fontWeight:"400"},children:[" (",(N=r==null?void 0:r.find(a=>(a==null?void 0:a.mandalartId)===(t==null?void 0:t.parentId)))==null?void 0:N.startDate,"부터)"]})]}),e.jsx("input",{type:"date",id:"startDate",name:"startDate",className:"popupInput",value:t==null?void 0:t.startDate,onChange:j})]}),e.jsxs("div",{className:"inputBox",children:[e.jsxs("label",{htmlFor:"startDate",children:["종료일",(t==null?void 0:t.depth)==1&&e.jsxs("span",{style:{color:"#999",fontWeight:"400"},children:[" (",s[4].finishDate,"까지)"]}),(t==null?void 0:t.depth)==2&&e.jsxs("span",{style:{color:"#999",fontWeight:"400"},children:["  (",(S=r==null?void 0:r.find(a=>(a==null?void 0:a.mandalartId)===(t==null?void 0:t.parentId)))==null?void 0:S.finishDate,"까지)"]})]}),e.jsx("input",{type:"date",id:"finishDate",name:"finishDate",className:"popupInput",value:t==null?void 0:t.finishDate,onChange:j})]}),e.jsxs("div",{className:"inputBox",children:[e.jsx("label",{htmlFor:"contents",children:"세부내용 작성"}),e.jsx("textarea",{id:"contents",name:"contents",className:"popupTextarea",placeholder:"간단설명을 입력하세요.",value:t.contents,onChange:j})]}),t.depth==2&&e.jsxs("div",{style:{display:"flex",marginBottom:"15px"},children:[e.jsx("span",{style:{marginRight:"20px"},children:"달성 여부"}),e.jsxs("div",{style:{display:"inline",alignItems:"center",gap:"20px"},children:[e.jsx("input",{type:"radio",name:"completedFg",value:"0",checked:t.completedFg===0,onChange:()=>v(0)})," 진행 중",e.jsx("input",{style:{marginLeft:"20px"},type:"radio",name:"completedFg",value:"1",checked:t.completedFg===1,onChange:()=>v(1)})," 달성 완료"]})]}),e.jsxs("div",{className:"buttonWrap",children:[e.jsx("button",{type:"button",className:"btnPopLine",onClick:I,children:"취소하기"}),e.jsx("button",{type:"submit",className:"btnPupColor",onClick:k,children:"저장하기"})]})]})]})}export{G as M};
